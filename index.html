<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>SDI Questionnaire – Full Test</title>
  <style>
    body { background: #f0f2f5; font-family: Arial, sans-serif; padding: 20px; max-width: 900px; margin: auto; }
    h1, h2 { color: #1877F2; text-align: center; }
    .section-title { color: #1877F2; font-size: 1.2em; margin: 20px 0 10px; }
    .question { background: #fff; border: 1px solid #ddd; padding: 15px; margin-bottom: 20px; border-radius: 8px; }
    .answers { margin-top: 10px; }
    .option { display: flex; align-items: center; margin: 5px 0; }
    .option label { flex: 1; }
    .option input { width: 60px; margin-left: 8px; padding: 4px; border: 1px solid #ccd0d5; border-radius: 4px; }
    .option input:focus { border-color: #1877F2; box-shadow: 0 0 3px rgba(24,119,242,0.5); outline: none; }
    .error { color: red; display: none; text-align: right; margin-top: 5px; font-size: 0.9em; }
    hr.section-break { border: none; border-top: 2px solid #1877F2; margin: 40px 0; }
    button { background: #1877F2; color: #fff; border: none; padding: 10px 16px; border-radius: 4px; cursor: pointer; margin-top: 15px; }
    button:disabled { background: #a3bffa; cursor: not-allowed; }
    .results { display: none; border-top: 2px solid #1877F2; padding-top: 20px; margin-top: 40px; }
    .triangle-container { text-align: center; margin-top: 20px; }
    canvas { background: #fff; border: 1px solid #ccc; }
    #dynamicResults { background: #fff; border: 1px solid #ddd; padding: 15px; margin-top: 20px; border-radius: 8px; text-align: left; }
    #dynamicResults h2 { color: #1877F2; font-size: 1.2em; margin-bottom: 10px; }
    #dynamicResults p { margin: 8px 0; }
  </style>
</head>
<body>
  <h1>SDI Questionnaire – Full Test</h1>
  <form id="quizForm"></form>
  <button type="button" id="submitBtn" disabled>Show Results</button>

  <div id="resultsSection">
    <div id="results1" class="results">
      <h2>Part 1: Normal Conditions</h2>
      <p id="totals1"></p>
      <div class="triangle-container"><canvas id="canvas1" width="300" height="260"></canvas></div>
    </div>
    <div id="results2" class="results">
      <h2>Part 2: Conflict Conditions</h2>
      <p id="totals2"></p>
      <div class="triangle-container"><canvas id="canvas2" width="300" height="260"></canvas></div>
    </div>
    <div id="dynamicResults"></div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const normalQs = [
        { text: "When I have free time, I usually:", labels: ["Help or care for others","Achieve something meaningful","Plan or organize logically","Do what feels right"] },
        { text: "When working with others, I prefer to:", labels: ["Support and encourage them","Lead and take charge","Think things through","Include everyone"] },
        { text: "When facing a challenge, I tend to:", labels: ["Seek harmony","Act quickly","Analyze in detail","Find common ground"] },
        { text: "I am most satisfied when I:", labels: ["Am helpful and supportive","Accomplish difficult goals","Solve complex issues","Am part of a team"] },
        { text: "In a disagreement, I usually:", labels: ["Understand feelings","Push for what's right","Reflect before responding","Help group unite"] },
        { text: "I feel successful when I:", labels: ["Am appreciated","Reach clear goals","Follow principles","Am accepted"] },
        { text: "I contribute most when I:", labels: ["Provide support","Make decisive progress","Offer structure","Create unity"] },
        { text: "I feel most appreciated when I:", labels: ["Am thanked","Recognized for achievements","Trusted for insight","Valued as team"] },
        { text: "I feel pressured when I:", labels: ["See others in distress","Can't take action","Feel disorganized","Feel unheard"] },
        { text: "I am most motivated when I:", labels: ["Make a difference","Have clear targets","Understand the 'why'","Belong and contribute"] },
        { text: "I define success as:", labels: ["Positive difference","Achieving goals","Being true to myself","Group alignment"] },
        { text: "I believe the best teams:", labels: ["Are caring","Are results-driven","Are logical","Are inclusive"] }
      ];
      const conflictQs = JSON.parse(JSON.stringify(normalQs));
      const letterMap = { A: 'Blue', B: 'Red', C: 'Green', D: 'Hub' };
      const blendNames = {
        'Blue-Red': 'Assertive-Nurturing',
        'Red-Green': 'Judicious-Competing',
        'Blue-Green': 'Cautious-Supporting'
      };
      const interpretations = {
        Blue: 'Altruistic-Nurturing: Its main concern is the protection and growth of others.',
        Red: 'Assertive-Directing: Its main concern is for task accomplishment and achieving desired results.',
        Green: 'Analytic-Autonomizing: Its main concern is for making sure that things are properly thought out.',
        Hub: 'Flexible-Cohering: Its main concern is for flexibility and welfare of the team/group – they try to build team consensus.'
      };
      const blendInterpretations = {
        'Assertive-Nurturing': 'Its main concern is for protection, growth, and welfare of others through task accomplishment.',
        'Judicious-Competing': 'Its main concern is for justice, leadership, order and fairness in competition.',
        'Cautious-Supporting': 'Its main concern is for affirming and developing self-sufficiency in self and others.'
      };
      const form = document.getElementById('quizForm');

      ['normal','conflict'].forEach((sec, si) => {
        const sectionQs = si === 0 ? normalQs : conflictQs;
        if (si === 1) {
          const hr = document.createElement('hr'); hr.className = 'section-break'; form.appendChild(hr);
        }
        const title = document.createElement('div'); title.className = 'section-title';
        title.textContent = si === 0 ? 'Part 1: Normal Conditions' : 'Part 2: Conflict Conditions';
        form.appendChild(title);
        sectionQs.forEach((q, i) => {
          const idx = si * 12 + i;
          const div = document.createElement('div'); div.className = 'question';
          div.innerHTML = `<strong>Q${idx+1}.</strong> ${q.text}`;
          const answersDiv = document.createElement('div'); answersDiv.className = 'answers';
          ['A','B','C','D'].forEach((lt, j) => {
            const opt = document.createElement('div'); opt.className = 'option';
            opt.innerHTML = `
              <label>${lt}. ${q.labels[j]}</label>
              <input type="number" data-q="${idx}" data-letter="${lt}" min="0" max="10" placeholder="0-10">
            `;
            answersDiv.appendChild(opt);
          });
          div.appendChild(answersDiv);
          const err = document.createElement('div'); err.className = 'error'; div.appendChild(err);
          form.appendChild(div);
        });
      });

      const inputs = Array.from(form.querySelectorAll('input'));
      const submitBtn = document.getElementById('submitBtn');
      const result1 = document.getElementById('results1');
      const result2 = document.getElementById('results2');
      const dyn = document.getElementById('dynamicResults');

      inputs.forEach(inp => inp.addEventListener('input', () => {
        let allValid = true;
        for (let q = 0; q < 24; q++) {
          const group = inputs.filter(i => +i.dataset.q === q);
          const vals = group.map(i => i.value.trim());
          const allFilled = vals.every(v => v !== '');
          const sum = group.reduce((a, i) => a + (+i.value || 0), 0);
          const errEl = group[0].closest('.question').querySelector('.error');
          if (!allFilled) { errEl.style.display = 'none'; allValid = false; }
          else if (sum !== 10) { errEl.textContent = sum > 10 ? `Exceeds by ${sum-10}` : `Short by ${10-sum}`; errEl.style.display = 'block'; allValid = false; }
          else { errEl.style.display = 'none'; }
        }
        submitBtn.disabled = !allValid;
      }));

      function draw(canvas, scores) {
        const ctx = canvas.getContext('2d'), w = canvas.width, h = canvas.height;
        const P1 = { x: 20, y: 20 }, P2 = { x: w-20, y: 20 }, P3 = { x: w/2, y: h-20 };
        const M12 = { x: (P1.x+P2.x)/2, y: (P1.y+P2.y)/2 };
        const M13 = { x: (P1.x+P3.x)/2, y: (P1.y+P3.y)/2 };
        const M23 = { x: (P2.x+P3.x)/2, y: (P2.y+P3.y)/2 };
        const C = { x: (P1.x+P2.x+P3.x)/3, y: (P1.y+P2.y+P3.y)/3 };
        ctx.clearRect(0, 0, w, h);
        ctx.fillStyle = '#2196F3'; ctx.beginPath(); ctx.moveTo(P1.x, P1.y); ctx.lineTo(M12.x, M12.y); ctx.lineTo(M13.x, M13.y); ctx.closePath(); ctx.fill();
        ctx.fillStyle = '#f44336'; ctx.beginPath(); ctx.moveTo(P2.x, P2.y); ctx.lineTo(M12.x, M12.y); ctx.lineTo(M23.x, M23.y); ctx.closePath(); ctx.fill();
        ctx.fillStyle = '#4CAF50'; ctx.beginPath(); ctx.moveTo(P3.x, P3.y); ctx.lineTo(M13.x, M13.y); ctx.lineTo(M23.x, M23.y); ctx.closePath(); ctx.fill();
        ctx.strokeStyle = '#333'; ctx.lineWidth = 1; ctx.beginPath(); ctx.moveTo(P1.x, P1.y); ctx.lineTo(P2.x, P2.y); ctx.lineTo(P3.x, P3.y); ctx.closePath(); ctx.stroke();
        const total = scores.Red + scores.Blue + scores.Green + scores.Hub;
        const px = (scores.Red*P2.x + scores.Blue*P1.x + scores.Green*P3.x + scores.Hub*C.x) / total;
        const py = (scores.Red*P2.y + scores.Blue*P1.y + scores.Green*P3.y + scores.Hub*C.y) / total;
        ctx.fillStyle = '#000'; ctx.beginPath(); ctx.arc(px, py, 5, 0, 2*Math.PI); ctx.fill();
      }

      submitBtn.addEventListener('click', () => {
        const scores1 = { Red:0, Blue:0, Green:0, Hub:0 };
        const scores2 = { Red:0, Blue:0, Green:0, Hub:0 };
        inputs.forEach(i => {
          const q = +i.dataset.q;
          const cat = letterMap[i.dataset.letter];
          const v = +i.value;
          if (q < 12) scores1[cat] += v; else scores2[cat] += v;
        });
        document.getElementById('totals1').textContent = `Red:${scores1.Red}, Blue:${scores1.Blue}, Green:${scores1.Green}, Hub:${scores1.Hub}`;
        draw(document.getElementById('canvas1'), scores1);
        document.getElementById('results1').style.display = 'block';
        document.getElementById('totals2').textContent = `Red:${scores2.Red}, Blue:${scores2.Blue}, Green:${scores2.Green}, Hub:${scores2.Hub}`;
        draw(document.getElementById('canvas2'), scores2);
        document.getElementById('results2').style.display = 'block';

        const dynEl = document.getElementById('dynamicResults');
        dynEl.innerHTML = '<h2>Your Results!</h2>';
        [scores1, scores2].forEach((scores, idx) => {
          const sorted = Object.entries(scores)
            .map(([k,v]) => ({k,v}))
            .sort((a,b) => b.v - a.v);
          if (sorted[0].v > sorted[1].v) {
            const style = sorted[0].k;
            dynEl.innerHTML += `<p><strong>Part ${idx+1}:</strong> Primary style <strong>${interpretations[style].split(':')[0]}</strong>.</p>`;
            dynEl.innerHTML += `<p>${interpretations[style]}</p>`;
          } else {
            const pairKey = [sorted[0].k, sorted[1].k].sort().join('-');
            const name = blendNames[pairKey];
            dynEl.innerHTML += `<p><strong>Part ${idx+1}:</strong> Blended style <strong>${name}</strong>.</p>`;
            dynEl.innerHTML += `<p>${blendInterpretations[name]}</p>`;
          }
        });
      });
    });
  </script>
</body>
</html>